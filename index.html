<!DOCTYPE html>
<html>

<head>
    <title>Health Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .button-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .button-container button {
            margin: 0 10px;
        }
    </style>
</head>

<body>
    <h1>Health Data Form</h1>
    <form id="healthForm">
        <label for="systolic">Systolic:</label>
        <input type="number" id="systolic" name="systolic" required><br><br>
        <label for="diastolic">Diastolic:</label>
        <input type="number" id="diastolic" name="diastolic" required><br><br>
        <label for="weight">Weight:</label>
        <input type="number" id="weight" name="weight" required><br><br>
        <input type="submit" value="Add/Update">
    </form>

    <div class="chart-container">
        <canvas id="healthChart"></canvas>
    </div>

    <div class="button-container">
        <button onclick="setRange(30)">30</button>
        <button onclick="setRange(60)">60</button>
        <button onclick="setRange(90)">90</button>
        <button onclick="setRange(365)">365</button>
    </div>

    <h2>Stored Data</h2>
    <table id="dataTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Systolic</th>
                <th>Diastolic</th>
                <th>Weight</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const healthChart = new Chart(
            document.getElementById('healthChart'),
            {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Systolic',
                            data: [],
                            borderColor: 'red',
                            backgroundColor: 'rgba(255, 0, 0, 0.2)',
                            fill: false,
                            lineTension: 0.1
                        },
                        {
                            label: 'Diastolic',
                            data: [],
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.2)',
                            fill: false,
                            lineTension: 0.1
                        },
                        {
                            label: 'Weight',
                            data: [],
                            borderColor: 'green',
                            backgroundColor: 'rgba(0, 128, 0, 0.2)',
                            fill: false,
                            lineTension: 0.1
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'black' // Set the color of the horizontal grid lines to black
                            }
                        }
                    },

                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Health Data'
                        }
                    }
                }
            }
        );

        function setRange(days) {
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            const storedData = JSON.parse(localStorage.getItem('healthData') || '[]');
            const filteredData = storedData.filter(item => new Date(item.date) >= startDate);

            const labels = filteredData.map(item => item.date);
            const systolicData = [];
            const diastolicData = [];
            const weightData = [];

            let prevSystolic, prevDiastolic, prevWeight;

            for (const item of filteredData) {
                const { date, systolic, diastolic, weight } = item;

                if (systolic !== null) {
                    systolicData.push(systolic);
                    prevSystolic = systolic;
                } else {
                    systolicData.push(prevSystolic || null);
                }

                if (diastolic !== null) {
                    diastolicData.push(diastolic);
                    prevDiastolic = diastolic;
                } else {
                    diastolicData.push(prevDiastolic || null);
                }

                if (weight !== null) {
                    weightData.push(weight);
                    prevWeight = weight;
                } else {
                    weightData.push(prevWeight || null);
                }
            }

            healthChart.data.labels = labels;
            healthChart.data.datasets[0].data = systolicData;
            healthChart.data.datasets[1].data = diastolicData;
            healthChart.data.datasets[2].data = weightData;
            healthChart.update();

            populateTable(filteredData);
        }

        function populateTable(data) {
            const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');
                const dateCell = document.createElement('td');
                const systolicCell = document.createElement('td');
                const diastolicCell = document.createElement('td');
                const weightCell = document.createElement('td');

                dateCell.textContent = item.date;
                systolicCell.textContent = item.systolic || '';
                diastolicCell.textContent = item.diastolic || '';
                weightCell.textContent = item.weight || '';

                row.appendChild(dateCell);
                row.appendChild(systolicCell);
                row.appendChild(diastolicCell);
                row.appendChild(weightCell);

                tableBody.appendChild(row);
            });
        }

        // Load stored data from local storage and populate the table and chart
        const storedData = JSON.parse(localStorage.getItem('healthData') || '[]');
        setRange(90); // Set the initial range to 90 days

        // Add an event listener for form submission
        const form = document.getElementById('healthForm');
        form.addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the form from submitting normally

            // Get the form data
            const systolic = document.getElementById('systolic').value;
            const diastolic = document.getElementById('diastolic').value;
            const weight = document.getElementById('weight').value;

            // Get the current date
            const currentDate = new Date().toLocaleDateString();

            // Check if there is already data for the current date
            const existingDataIndex = storedData.findIndex(item => item.date === currentDate);

            if (existingDataIndex >= 0) {
                // Update existing record
                storedData[existingDataIndex] = {
                    date: currentDate,
                    systolic,
                    diastolic,
                    weight
                };
            } else {
                // Add new record
                storedData.push({
                    date: currentDate,
                    systolic,
                    diastolic,
                    weight
                });
            }

            // Store the data in the browser's local storage
            localStorage.setItem('healthData', JSON.stringify(storedData));

            // Update the table and chart
            setRange(90);

            // Clear the form fields
            document.getElementById('systolic').value = '';
            document.getElementById('diastolic').value = '';
            document.getElementById('weight').value = '';
        });

        // Function to check for existing data on page load and populate form if data exists
        function loadExistingData() {
            const currentDate = new Date().toLocaleDateString();
            const existingData = storedData.find(item => item.date === currentDate);

            if (existingData) {
                document.getElementById('systolic').value = existingData.systolic;
                document.getElementById('diastolic').value = existingData.diastolic;
                document.getElementById('weight').value = existingData.weight;
                form.querySelector('input[type="submit"]').value = 'Add/Update';
            }
        }

        // Load existing data on page load
        loadExistingData();
    </script>
</body>

</html>